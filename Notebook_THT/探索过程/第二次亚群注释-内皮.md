# 内皮细胞注释过程及结果记录         (What)

* Nov 21, 2025                                 (When)
* liyi /data1/liyi/zhaoyue/FUSCC-ESCC-neoadjuvant_thrapy           (Where)
* 单细胞需要注释后才能进行后续分析 (Why)

#### 先看看聚类和celltypist注释情况
<img src="..\figures\umapEndothelial cell_umapmd0.4_regressmtribo_cluster.png">
<img src="..\figures\umap1121_celltypist__Endo.png">

#### 看下大类marker，是否有双细胞
```
import scanpy as sc

sc.settings.set_figure_params(
    dpi=300,
    facecolor="white",
    frameon=False
)
sc.settings.figdir = "plots"

adata = sc.read("RData/Endothelial cell__umapmd0.4.h5ad")

marker_genes = ["PTPRC","CD3E","CD79A","COL1A1",
"VWF","PECAM1","EPCAM","SFN","KRT5","LYZ","GCA","TPSAB1"]
sc.pl.umap(adata,color=marker_genes,vmin=0,vmax="p99",sort_order=False,cmap="Blues",save="121_Endo_majormarker.png")
```
<img src="..\figures\umap121_Endo_majormarker.png">
0.8第5群混了上皮细胞，去掉

```
adata = adata[adata.obs.leiden_res0_8 != '5'].copy()
```

#### 筛marker
```
marker_genes = {
    "AEC": ["GJA5", "FBLN5", "GJA4", "ENPP2", "SULF1"],
    "capEC": ["CA4", "CD36", "RGCC", "CD320", "SGK1", "SPP1", "GSN", "PLVAP"],
    "LEC": ["PROX1", "LYVE1", "CCL21", "TFPI", "PDPN", "TFF3"],
    "VEC": ["ACKR1", "SELP", "CLU", "CCL14", "CPE", "C7", "POSTN"],
    "TipEC": ["COL4A1", "KDR", "ESM1", "CXCR4", "TP53I11", "PGF", "ESM1"],
    "HypoxiaEC": ["MT1X", "MT1E", "MT2A"],
    "prfEC": ["PTTG1", "TYMS", "MKI67", "TOP2A", "CENPF"]
}
marker_genes_in_data = {}
for ct, markers in marker_genes.items():
    markers_found = []
    for marker in markers:
        if marker in adata.var.index:
            markers_found.append(marker)
    marker_genes_in_data[ct] = markers_found
sc.pl.umap(adata,color=marker_genes_in_data["AEC"],vmin=0,vmax="p99",sort_order=False,cmap="Reds",save="121Endo_AECmarkers.png")
sc.pl.umap(adata,color=marker_genes_in_data["capEC"],vmin=0,vmax="p99",sort_order=False,cmap="Reds",save="121Endo_capECmarkers.png")
sc.pl.umap(adata,color=marker_genes_in_data["LEC"],vmin=0,vmax="p99",sort_order=False,cmap="Reds",save="121Endo_LECmarkers.png")
sc.pl.umap(adata,color=marker_genes_in_data["VEC"],vmin=0,vmax="p99",sort_order=False,cmap="Reds",save="121Endo_VECmarkers.png")
sc.pl.umap(adata,color=marker_genes_in_data["TipEC"],vmin=0,vmax="p99",sort_order=False,cmap="Reds",save="121Endo_TipECmarkers.png")
sc.pl.umap(adata,color=marker_genes_in_data["HypoxiaEC"],vmin=0,vmax="p99",sort_order=False,cmap="Reds",save="121Endo_HypoxiaECmarkers.png")
sc.pl.umap(adata,color=marker_genes_in_data["prfEC"],vmin=0,vmax="p99",sort_order=False,cmap="Reds",save="121Endo_prfECmarkers.png")
```
<img src="..\figures\umapEndothelial cell_umapmd0.4_regressmtribo_cluster.png">
0.8的第3群,"GJA4","GJA5","FBLN5","SULF1"
<img src="..\figures\umap121Endo_AECmarkers.png">
第1,2,6群,"RGCC"
<img src="..\figures\umap121Endo_capECmarkers.png">
0.8的第7群,"PROX1","CCL21", "TFPI", "PDPN", "TFF3"
<img src="..\figures\umap121Endo_LECmarkers.png">
0.8的0和4群？"ACKR1","CLU"
<img src="..\figures\umap121Endo_VECmarkers.png">
第2群?不太明确
<img src="..\figures\umap121Endo_TipECmarkers.png">
没有这一群
<img src="..\figures\umap121Endo_HypoxiaECmarkers.png">
倒是有这一群，res2的第15群
<img src="..\figures\umap121Endo_prfECmarkers.png">

#### 先看一波DEG
```
sc.tl.rank_genes_groups(
 adata, groupby="leiden_res0_8", method="wilcoxon", key_added="dea_leiden_res0_8"
)
sc.tl.filter_rank_genes_groups(
  adata,
  min_in_group_fraction=0.2,
  max_out_group_fraction=0.2,
  key="dea_leiden_res0_8",
  key_added="dea_leiden_res0_8_filtered",
 )
sc.pl.rank_genes_groups_dotplot(
  adata,
  groupby="leiden_res0_8",
  standard_scale="var",
  n_genes=10,
  key="dea_leiden_res0_8_filtered",
  save="regressmtribo_121_res0_8_Endo_top10gene.png"
)
```
<img src="..\figures\dotplot_regressmtribo_121_res0_8_Endo_top10gene.png">

#### 添加注释
0:VEC, "ACKR1","CLU","ITPKC","PDK4"
4:VEC, "ACKR1","CLU",
1,2:capEC,"RGCC","SPRY4","EDIL3"
6:capEC,"RGCC","CSF2RB","ZNF267"
3:AEC,"GJA4","GJA5","FBLN5","SULF1"
7:LEC,"PROX1","CCL21", "TFPI", "PDPN", "TFF3"
15:prfEC,"PTTG1", "TYMS", "MKI67", "TOP2A", "CENPF"
```
cl_annotation = {
        "0": "VEC_IDPKC",
        "4": "VEC_ACKR1",
        "1": "capEC_RGCC",
        "2": "capEC_RGCC",
        "6": "EC_CSF2RB",
        "3": "AEC_GJA4",
        "7": "LEC_PROX1",
    }
adata.obs["Endo_clt"]=adata.obs.leiden_res0_8.map(cl_annotation)
adata.obs.loc[adata.obs['leiden_res2'] == '15', 'Endo_clt'] = 'prfEC_MKI67'
marker_genes = {
    "VEC1": ["ACKR1","CLU","ITPKC","PDK4"],
    "VEC2": ["ACKR1","CLU","TLL1","TACR1"],
    "capEC": ["RGCC","SPRY4","EDIL3"],
    "capEC": ["RGCC","CSF2RB","ZNF267"],
    "AEC": ["GJA4","GJA5","FBLN5","SULF1"],
    "LEC": ["PROX1", "LYVE1", "CCL21", "TFPI", "PDPN", "TFF3"],
    "prfEC": ["PTTG1", "TYMS", "MKI67", "TOP2A", "CENPF"]
}
sc.pl.dotplot(
            adata,
            groupby="Endo_clt",
            var_names=marker_genes,
            standard_scale="var",
            save="经典marker_EC亚群.png"
        )
```
<img src="..\figures\dotplot_经典marker_EC亚群.png">
第6群不写功能吧，不知道是VEC还是capEC

```

```
